# 건강검진 데이터를 활용한 콜레스테롤 수치 예측 및 건강지표 연관성 분석

## 프로젝트 개요

### 프로젝트 제목

**건강검진 데이터를 활용한 콜레스테롤 수치 예측 및 건강지표 연관성 분석**

### 연구 동기 및 배경

국민건강검진은 질병의 조기 발견과 예방을 위한 국가 차원의 제도로, 매년 수백만 명의 건강 데이터가 축적되고 있습니다. 하지만 현재 건강검진 결과는 단순 수치 제공에 그치며, 개인 맞춤형 건강 관리나 예측 기반 건강 분석에는 한계가 있습니다.

콜레스테롤 수치는 심혈관 질환, 고혈압, 당뇨 등 다양한 만성 질환과 밀접한 관련이 있으며, 이를 조기에 예측하고 관리하는 것은 예방의학 측면에서 매우 중요합니다. 또한 치석, 충치 등 구강 건강과 전신 건강의 연관성은 학술적으로 밝혀지고 있으나, 이를 활용한 건강 예측 모델은 드문 실정입니다.

### 해결하고자 하는 문제 정의

1. 건강검진 데이터를 기반으로 콜레스테롤 수치(총, HDL, LDL 등)의 이상 여부를 사전 예측할 수 있는가?
2. 생활습관(흡연, 음주)이나 구강 건강(치석, 치아우식증 등)과 전신 건강(혈압, 혈당, 간수치 등) 사이에 유의미한 연관성이 존재하는가?
3. 기존의 단일 수치 중심 진단 방식에서 벗어나, 다변량 기반 건강 위험 탐지 시스템을 설계할 수 있는가?

## 관련 연구 및 기술 배경

- 기존 연구는 주로 단일 요인(흡연, 고혈압 등)과 특정 질환 간의 상관관계 분석에 집중되어 있습니다.
- WHO의 식이 가이드라인에 따르면, 포화지방과 트랜스지방의 과다 섭취는 총콜레스테롤 및 LDL 수치를 상승시켜 심혈관 질환 위험을 높입니다.
- 구강 건강(치석, 치아 우식증 등)과 전신 건강 간의 직접적인 연계 분석은 매우 드뭅니다.

### 본 프로젝트의 차별점

- 구강 검진 지표까지 포함한 **다변량 예측** 시도
- 머신러닝 회귀 모델(Random Forest, XGBoost 등) 적용으로 정량적 예측 가능
- 변수 간 상관관계 분석과 예측 모델을 동시에 설계하여 건강지표의 잠재적 패턴을 정량적으로 시각화
- 향후 개인화된 건강 점수 시스템이나 건강 위험 조기 경고 서비스로 확장 가능성

## 데이터 및 모델 설계

- **데이터:** 국민건강보험공단_건강검진정보(2023)
- **전처리:** 결측치는 영향이 미미하면 삭제, 그렇지 않으면 지역/연령/성별 등 유사 그룹의 평균값 또는 최빈값으로 대체. 이상치는 필터링 및 시각화로 확인 후 처리.
- **특성 엔지니어링:** 당뇨 위험군 등 새로운 컬럼 생성, 범주형 데이터는 Label-Encoding/One-Hot Encoding, 정규화/표준화 적용
- **모델:**
    - 회귀: Linear Regression, RandomForestRegressor, XGBoost 등으로 콜레스테롤 등 수치 예측
    - 분류: Logistic Regression, RandomForestClassifier, XGBoost 등으로 질병 위험군 예측
    - 군집화: KMeans 등으로 건강 패턴 그룹화
- **시각화:** 지역별, 연령대별, 변수별 특징 및 상관관계 대시보드 제공

## 모델 성능 평가 및 실험 결과

### 구현된 모델 및 성능

#### 1. 회귀 모델 (콜레스테롤 수치 예측)
**데이터 규모:** 50,000개 샘플 (전체 데이터에서 성능 최적화를 위해 샘플링)

| 모델 | MAE | RMSE | R² | 교차검증 R² |
|------|-----|------|----|-----------| 
| Linear Regression | 29.147 | 37.243 | 0.3891 | 0.3889±0.0048 |
| Random Forest | 24.982 | 32.136 | 0.5455 | 0.5464±0.0055 |
| XGBoost | 24.613 | 31.721 | 0.5571 | 0.5580±0.0046 |

**최고 성능 모델:** XGBoost (R²=0.5571, RMSE=31.72 mg/dL)

#### 2. 분류 모델 (고콜레스테롤 위험군 예측)
**목표변수:** 총콜레스테롤 ≥ 240mg/dL을 고위험군으로 분류
**고콜레스테롤 위험군 비율:** 14.2%

| 모델 | 정확도 | 교차검증 정확도 |
|------|--------|----------------|
| Logistic Regression | 0.8579 | 0.8580±0.0025 |
| Random Forest | 0.8633 | 0.8635±0.0028 |
| XGBoost | 0.8651 | 0.8653±0.0024 |

**최고 성능 모델:** XGBoost (정확도=86.51%)

#### 3. 군집 분석 (건강 패턴 그룹화)
**분석 데이터:** 10,000개 샘플 (20개 건강지표 포함)
**최적 클러스터 수:** 3개 (실루엣 점수: 0.421)

| 클러스터 | 명칭 | 인원수 | 비율 | 주요 특성 |
|----------|------|--------|------|----------|
| 클러스터 0 | 고령층_중간위험군 | 5,056명 | 50.6% | 평균연령대 12.2, 여성 83%, BMI 22.5 |
| 클러스터 1 | 중년층_중간위험군 | 4,939명 | 49.4% | 평균연령대 10.6, 남성 92.4%, BMI 26.1 |
| 클러스터 2 | 고령층_고위험군 | 5명 | 0.05% | 평균 총콜레스테롤 261.6 mg/dL |

#### 4. 특성 중요도 분석
**Random Forest 상위 5개 중요 특성:**
1. HDL콜레스테롤 (중요도: 0.347)
2. 트리글리세라이드 (중요도: 0.298)
3. 연령대코드 (중요도: 0.112)
4. BMI (중요도: 0.089)
5. 허리신장비 (중요도: 0.076)

**XGBoost 상위 5개 중요 특성:**
1. HDL콜레스테롤 (중요도: 0.421)
2. 트리글리세라이드 (중요도: 0.289)
3. 연령대코드 (중요도: 0.098)
4. 허리신장비 (중요도: 0.087)
5. BMI (중요도: 0.071)

### 심화 분석 내용

#### 1. 통계적 유의성 검정 결과
- **성별에 따른 총콜레스테롤 차이:** 
  - 남성 평균: 194.23±38.42 mg/dL
  - 여성 평균: 198.87±39.21 mg/dL
  - t-검정 p-value < 0.001 (유의함)

- **연령대별 총콜레스테롤 차이:** 
  - ANOVA F-통계량: 145.67
  - p-value < 0.001 (유의함)

- **흡연 상태와 고콜레스테롤 연관성:**
  - χ² 통계량: 23.45
  - p-value < 0.001 (유의함)

#### 2. 상관관계 분석
- **총콜레스테롤과 주요 건강지표 간 상관계수:**
  - 트리글리세라이드: r=0.452 (강한 양의 상관)
  - LDL콜레스테롤: r=0.923 (매우 강한 양의 상관)
  - HDL콜레스테롤: r=0.124 (약한 양의 상관)
  - 수축기혈압: r=0.234 (중간 양의 상관)
  - 식전혈당: r=0.198 (약한 양의 상관)

## 프로젝트 구현 현황

### 완료된 작업

1. **데이터 전처리** (`preprocessing.ipynb`)
   - 1,000,000건 건강검진 데이터 처리
   - 결측치 및 이상치 처리 완료
   - 데이터 타입 변환 및 정규화 적용
   - 50개 이상의 변수별 박스플롯 및 분포 시각화 생성
   - 최종 전처리된 데이터: `health_2023_cleaned_final.csv`

2. **심화 탐색적 데이터 분석** (`advanced_eda.ipynb`)
   - 20×20 상관관계 히트맵 생성 및 분석
   - 통계적 유의성 검정: t-test, ANOVA, 카이제곱 검정 모두 완료
   - 성별/연령대별 건강지표 차이 분석 (모든 검정에서 p<0.001)
   - 구강 건강과 전신 건강 연관성 분석
   - 주요 건강지표 간 산점도 매트릭스 생성

3. **개선된 예측 모델** (`improved_prediction_models.ipynb`)
   - **회귀 모델:** Linear Regression, Random Forest, XGBoost 구현 및 비교
     - 최고 성능: XGBoost (R²=0.5571, RMSE=31.72mg/dL)
     - 5-fold 교차 검증 및 하이퍼파라미터 최적화 완료
   - **분류 모델:** Logistic Regression, Random Forest, XGBoost 구현 및 비교
     - 최고 성능: XGBoost (정확도=86.51%)
     - 혼동 행렬 및 분류 보고서 생성
   - **특성 중요도 분석:** Random Forest & XGBoost 특성 중요도 시각화
   - **예측 결과 시각화:** 실제값 vs 예측값 산점도, 잔차 분석

4. **군집 분석** (`improved_kmeans_analysis.ipynb`)
   - 20개 건강지표를 활용한 KMeans 클러스터링
   - 엘보우 방법 및 실루엣 분석으로 최적 클러스터 수 결정 (k=3)
   - 실루엣 점수: 0.421
   - PCA를 통한 2차원 시각화 및 클러스터별 특성 분석
   - 3개 클러스터 프로파일 생성 및 명명:
     - 고령층_중간위험군 (50.6%)
     - 중년층_중간위험군 (49.4%) 
     - 고령층_고위험군 (0.05%)

5. **기타 분석 노트북들**
   - `prediction_colestrol.ipynb`: 초기 콜레스테롤 예측 모델
   - `prediction_obesity.ipynb`: 비만 예측 분석
   - `prediction.ipynb`: 기본 예측 모델
   - `KMeans.ipynb`: 기본 군집분석

### 생성된 결과물

**시각화 파일 (plots/ 디렉토리):**
- 변수별 박스플롯: 24개 파일 (`boxplot_*.png`)
- 변수별 분포 그래프: 24개 파일 (`distribution_*.png`) 
- 상관관계 히트맵: `correlation_heatmap.png`
- 특성 중요도 그래프: `feature_importance_regression.png`
- 군집분석 결과: `cluster_*.png` (5개 파일)
- 모델 성능 비교: `model_performance_comparison.png`
- 예측 결과: `prediction_results.png`
- 혼동 행렬: `confusion_matrices.png`

**분석 결과 테이블:**
- 클러스터 통계: `cluster_statistics.csv`
- 클러스터 요약: `cluster_summary.csv` 
- 클러스터 프로파일: `cluster_profiles.csv`

5. **질병 예측 시스템** (`prediction_obesity.ipynb`, `prediction.ipynb`)
   - 임상 기준 기반 질병 의심 플래그 생성
   - 당뇨병, 고혈압, 고지혈증, 간질환 등 예측

### 주요 성과
### 주요 성과 지표
- **데이터 규모:** 1,000,000건의 건강검진 데이터 처리 (분석용 50,000건 샘플링)
- **시각화:** 50개 이상의 건강지표별 분포, 박스플롯, 상관관계 히트맵 생성
- **회귀 모델 성능:** XGBoost 최고 성능 (R²=0.5571, RMSE=31.72 mg/dL)
- **분류 모델 성능:** XGBoost 최고 성능 (정확도=86.51%)
- **군집 분석:** 실루엣 점수 0.421로 3개의 의미있는 건강 패턴 그룹 식별
- **통계적 유의성:** 성별, 연령대, 흡연 상태에 따른 콜레스테롤 차이 모두 p<0.001로 유의함

## 프로젝트 실행 결과 요약

### 핵심 발견사항

1. **콜레스테롤 예측 모델의 주요 예측 인자**
   - HDL콜레스테롤과 트리글리세라이드가 가장 중요한 예측 변수 (중요도 70% 이상)
   - 연령대, BMI, 허리신장비가 추가적인 예측력 제공
   - XGBoost 모델이 가장 우수한 성능 (R²=0.5571)

2. **건강 패턴 그룹 특성**
   - **고령층 중간위험군 (50.6%):** 여성 중심, 상대적으로 건강한 지표
   - **중년층 중간위험군 (49.4%):** 남성 중심, 높은 흡연/음주율, 높은 BMI
   - **고령층 고위험군 (0.05%):** 극소수 그룹, 매우 높은 콜레스테롤 수치

3. **통계적으로 검증된 건강지표 간 연관성**
   - 총콜레스테롤과 LDL콜레스테롤 간 매우 강한 상관관계 (r=0.923)
   - 성별에 따른 콜레스테롤 수치 유의한 차이 (여성이 남성보다 평균 4.64mg/dL 높음)
   - 흡연과 고콜레스테롤 위험 간 통계적으로 유의한 연관성 확인

4. **모델 활용 가능성**
   - 86.51% 정확도로 고콜레스테롤 위험군 사전 예측 가능
   - 평균 31.72mg/dL 오차 범위 내에서 콜레스테롤 수치 예측 가능
   - 건강 패턴 그룹별 맞춤형 관리 방안 설계 가능

## 기대 효과 및 한계점

### 기대 효과
- 건강검진 데이터를 활용한 콜레스테롤 수치의 정확한 예측 모델 구축
- 구강 건강과 전신 건강 간의 연관성에 대한 새로운 인사이트 발견
- 다변량 분석을 통한 건강 위험 조기 탐지 시스템 설계
- 개인화된 건강 점수 시스템이나 건강 위험 조기 경고 서비스로의 확장 가능성
- 예방의학 관점에서 만성질환 예방을 위한 기초 데이터 제공

### 한계점 및 해결 방안
- 결측치 처리: 다양한 대체 방법 적용 및 변수별 영향 분석
- 의학적 해석의 한계: 문헌 검토 및 결과 해석 시 제한점 명시
- 인과관계 해석의 어려움: 추가적인 인과추론 방법 적용 및 상관관계와 인과관계 구분

## 프로젝트 파일 구조

```
cholesterol-prediction-nhis/
├── data/                                  # 데이터 파일
│   ├── Health_2023.csv                    # 원본 데이터 (1,000,000건)
│   ├── health_2023_cleaned.csv            # 1차 전처리 데이터
│   └── health_2023_cleaned_final.csv      # 최종 전처리 데이터
├── plots/                                 # 시각화 및 분석 결과물 (총 70개 파일)
│   ├── boxplot_*.png                      # 변수별 박스플롯 (24개)
│   ├── distribution_*.png                 # 변수별 분포 그래프 (24개)
│   ├── correlation_heatmap.png            # 상관관계 히트맵
│   ├── feature_importance_regression.png  # 특성 중요도 분석
│   ├── cluster_*.png                      # 군집분석 시각화 (5개)
│   ├── model_performance_comparison.png   # 모델 성능 비교
│   ├── prediction_results.png             # 예측 결과 시각화
│   ├── confusion_matrices.png             # 혼동 행렬
│   ├── cluster_statistics.csv             # 클러스터 상세 통계
│   ├── cluster_summary.csv                # 클러스터 요약
│   └── cluster_profiles.csv               # 클러스터 프로파일
├── preprocessing.ipynb                    # 데이터 전처리
├── advanced_eda.ipynb                     # 심화 탐색적 데이터 분석
├── improved_prediction_models.ipynb       # 개선된 예측 모델 (최종)
├── improved_kmeans_analysis.ipynb         # 개선된 군집 분석 (최종)
├── prediction_colestrol.ipynb             # 초기 콜레스테롤 예측
├── prediction_obesity.ipynb               # 비만 예측 분석
├── prediction.ipynb                       # 기본 예측 모델
├── KMeans.ipynb                          # 기본 군집분석
├── health_sample.csv                     # 샘플 데이터
├── health_with_disease_flags.csv         # 질병 플래그 포함 데이터
├── requirements.txt                      # 패키지 의존성
├── LICENSE                               # 라이센스
└── README.md                             # 프로젝트 문서 (본 파일)
```

## 실행 방법

1. **환경 설정**
   ```bash
   pip install -r requirements.txt
   ```

2. **데이터 준비**
   - `data/health_2023_cleaned_final.csv` 파일 확인

3. **노트북 실행 순서**
   - `preprocessing.ipynb` → `advanced_eda.ipynb` → `improved_prediction_models.ipynb` → `improved_kmeans_analysis.ipynb`

4. **결과 확인**
   - `plots/` 디렉토리에서 시각화 결과 확인
   - 각 노트북의 출력 결과 및 성능 지표 확인
├── 빅데이터프로그래밍/                        # 수업 자료
│   ├── 2. week2/                         # 데이터 분석 프로세스
│   ├── 3. week3/                         # 데이터 정제 및 분석
│   ├── 5. week5/                         # 데이터 시각화
│   └── ...
├── preprocessing.ipynb                    # 데이터 전처리
├── advanced_eda.ipynb                     # 심화 탐색적 데이터 분석
├── improved_prediction_models.ipynb       # 개선된 예측 모델
├── improved_kmeans_analysis.ipynb         # 개선된 군집 분석
├── prediction_obesity.ipynb               # 질병 예측 시스템
├── requirements.txt                       # 필요 라이브러리
└── README.md                             # 프로젝트 설명서
```

## 사용법

### 1. 환경 설정
```bash
pip install -r requirements.txt
```

### 2. 분석 순서
1. **데이터 전처리**: `preprocessing.ipynb` 실행
2. **심화 EDA**: `advanced_eda.ipynb` 실행  
3. **예측 모델링**: `improved_prediction_models.ipynb` 실행
4. **군집 분석**: `improved_kmeans_analysis.ipynb` 실행

### 3. 주요 결과 확인
- `plots/` 폴더의 시각화 결과물 확인
- 각 노트북의 마지막 셀에서 성능 요약 확인
- CSV 파일로 저장된 분석 결과 테이블 활용

## 참고 문헌
- WHO. Diet, nutrition and the prevention of chronic diseases. (2003)
- 대한치주과학회, 2016; 건강보험심사평가원, 2020
- https://www.who.int/news-room/fact-sheets/detail/tobacco
- https://iris.who.int/bitstream/handle/10665/36838/8970890556_kor.pdf

---

본 프로젝트는 국민건강보험공단의 건강검진 데이터를 활용하여, 콜레스테롤 수치 예측 및 건강지표 간 연관성 분석을 통해 개인 맞춤형 건강관리와 예방의학 발전에 기여하고자 합니다.

